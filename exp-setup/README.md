# XDP Experiment Setup

```

  Cisco tRex                         Device Under Test(DUT)
  traffic generator                  with XDP programs     
  +-------------------+              +--------------------+
  |                   |              |                    |
  |              eth1 ----------------eth1                |
  |                   |              |                    |
  |                   |              |                    |
  |              eth2 ----------------eth2                |
  |                   |              |                    |
  +-------------------+              +--------------------+
 
```

**DUT**
Configuring the interfaces on a DUT machine
sending traffic from eth1 to eth2 
16.x.x.x and 48.x.x.x are IP address of tRex emulated clients and server respectively.

```bash
# enable forwarding packets
vagrant@xdp-DUT:~$ sudo echo 1 > /proc/sys/net/ipv4/ip_forward
vagrant@xdp-DUT:~$ sudo route add -net 16.0.0.0 netmask 255.0.0.0 gw 198.18.1.11
vagrant@xdp-DUT:~$ sudo route add -net 48.0.0.0 netmask 255.0.0.0 gw 198.18.2.11
```

Attach XDP program

```bash
vagrant@xdp-DUT:~/linux-5.15.0/samples/bpf$ sudo ./xdp1 eth1 -S
```

**tRex**

Configure the interfaces to send and receive data in tRex

```bash
sudo ./dpdk_setup_ports.py -i
```

```yaml
### Config file generated by dpdk_setup_ports.py ###

- version: 2
  interfaces: ['00:08.0', '00:09.0']
  port_info:
      - ip: 198.18.1.11
        default_gw: 198.18.1.10
      - ip: 198.18.2.11
        default_gw: 198.18.2.10

  platform:
      master_thread_id: 0
      latency_thread_id: 1
      dual_if:
        - socket: 0
          threads: [2,3]
```

Fix Python
```
cd /usr/lib/x86_64-linux-gnu/
sudo ln -s -f libc.a liblibc.a
```

Launch the TRex server in Stateless mode:

```bash
cd v3.XX
vagrant@tRex:/opt/trex/v3.00$ sudo ./t-rex-64 -i
```

Launch the TRex console

```bash
vagrant@tRex:/opt/trex/v3.00$ ./trex-console
Server Info:

Server version:   v3.00 @ STL
Server mode:      Stateless
Server CPU:       1 x Intel(R) Core(TM) i5-6360U CPU @ 2.00GHz
Ports count:      2 x 1Gbps @ 82540EM Gigabit Ethernet Controller
```

Start traffic
```
trex> start -f stl/udp_for_benchmarks.py --port 0 -m 1mpps -t packet_len=64,stream_count=1
```


**Resources:**

* Vagrant file - https://github.com/aojea/pytest-trex
* Network Setup - https://promwad.com/news/cisco-trex-traffic-generator
* https://satishdotpatel.github.io/trex-load-generator/