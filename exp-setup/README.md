# XDP Experiment Setup

```

  Cisco tRex                         Device Under Test(DUT)
  traffic generator                  with XDP programs     
  +-------------------+              +--------------------+
  |                   |              |                    |
  |              eth1 ----------------eth1                |
  |                   |              |                    |
  |                   |              |                    |
  |              eth2 ----------------eth2                |
  |                   |              |                    |
  +-------------------+              +--------------------+
 
```

**DUT**
Configuring the interfaces on a DUT machine
sending traffic from eth1 to eth2 
16.x.x.x and 48.x.x.x are IP address of tRex emulated clients and server respectively.

```bash
# enable forwarding packets
vagrant@xdp-DUT:~$ sudo echo 1 > /proc/sys/net/ipv4/ip_forward
vagrant@xdp-DUT:~$ sudo route add -net 16.0.0.0 netmask 255.0.0.0 gw 192.168.253.106
vagrant@xdp-DUT:~$ sudo route add -net 48.0.0.0 netmask 255.0.0.0 gw 192.168.254.106
```

Attach XDP program

```bash
vagrant@xdp-DUT:~/linux-5.15.0/samples/bpf$ sudo ./xdp1 eth1 -S
```

**tRex**

Configure the interfaces to send and receive data in tRex

```bash
sudo ./dpdk_setup_ports.py -i
```

```yaml
### Config file generated by dpdk_setup_ports.py ###
- version: 2 interfaces: ['01:00.0', '01:00.3']
port_info:
- ip: 192.168.253.106
default_gw: 192.168.253.107
- ip: 192.168.254.106
default_gw: 192.168.254.107
platform:
master_thread_id: 0
latency_thread_id: 1
dual_if:
- socket: 0
threads: [2,3,4,5,6,7]
```

Launch the TRex server in Stateless mode:

```bash
cd v3.XX
vagrant@tRex:/opt/trex/v3.00$ sudo ./t-rex-64 -i
```

Launch the TRex console

```bash
vagrant@tRex:/opt/trex/v3.00$ ./trex-console
Server Info:

Server version:   v3.00 @ STL
Server mode:      Stateless
Server CPU:       1 x Intel(R) Core(TM) i5-6360U CPU @ 2.00GHz
Ports count:      2 x 1Gbps @ 82540EM Gigabit Ethernet Controller
```

Start traffic
```
trex> start -f stl/udp_for_benchmarks.py --port 0 -m 1mpps -t packet_len=64,stream_count=1
```


**Resources:**

* Vagrant file - https://github.com/aojea/pytest-trex
* Network Setup - https://promwad.com/news/cisco-trex-traffic-generator